{% extends "student/layout.html" %}

{% block content %}
    <h1>Manual Enrollment Request</h1>
    <p>This service is for both regular and irregular students of the University and is done during the adjustment period. It is used when the student fails to enroll during the online registration period set by the University.</p>

    <p><a href="{{url_for('download_RO_form')}}">Download Application file for Request Form</a></p>
    <br>  
    <br>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <br>
    <br>
    <br>
    <h1>Manual Enrollment Form</h1>
    <form id="manualEnrollmentForm" action="{{ url_for('submitmanualenrollment') }}" method="POST" enctype="multipart/form-data">
        <label for="StudentNumber">Student Number:</label><br>
        <input type="text" id="StudentNumber" name="StudentNumber" required><br><br>

        <label for="Name">Student Name:</label><br>
        <input type="text" id="Name" name="Name" required><br><br>

        <label for="enrollmentType">Enrollment Type:</label><br>
        <select id="enrollmentType" name="enrollment_type" required>
            <option value="Regular">Regular</option>
            <option value="Irregular">Irregular</option>
            <option value="Special">Special</option>
            <!-- Add more options as needed -->
        </select><br><br>
    
        <label for="reason">Reason:</label><br>
        <textarea id="reason" name="reason" rows="4" cols="50" required></textarea><br><br>

        <label for="meFile">File:</label><br>
        <input type="file" id="meFile" name="me_file" required><br><br>

        <label for="user_responsible">User Responsible:</label>
        <select id="user_responsible" name="user_responsible" required>
            <option value="Faculty">Faculty Member/s</option>
            <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
            <option value="CDO Cashier/Accounting Office">CDO Cashier/Accounting Office</option>
        </select><br><br>

        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="Sent" selected>Sending</option>
            <option value="Pending" disabled>Pending</option>
            <option value="Approved" disabled>Approved</option>
            <option value="Rejected" disabled>Rejected</option>
        </select><br><br>

        <button type="submit">Submit</button>
    </form>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function() {
            // Automatically close the alert messages after 3 seconds
            setTimeout(function() {
                $('.alert').alert('close');
            }, 3000);
    
            // Form submission logic
            $('#manualEnrollmentForm').submit(function(event) {
                const StudentNumber = $('#StudentNumber').val().trim();
                const Name = $('#Name').val().trim();
                const enrollmentType = $('#enrollmentType').val().trim();
                const reason = $('#reason').val().trim();
    
                if (!StudentNumber || !name || !enrollmentType || !reason) {
                    alert('Please fill out all fields and provide valid values.');
                    event.preventDefault();  // Prevent form submission
                }
    
                // Additional validation logic can be added here
            });
        });
    </script>
{% endblock content %}

{% block script %}
 <script>
    // Fetch student details
    async function fetchStudentDetails() {
        try {
            const response = await fetch(`${api_base_url}/student-details`);

            if (!response.ok) {
                throw new Error(`Failed to fetch data. Server returned ${response.status}`);
            }

            const data_student_details = await response.json();
            console.log('data_student_details:', data_student_details);
            displayDetails(data_student_details);
        } catch (error) {
            console.error('Error fetching student details:', error.message);
        }
    }

    fetchStudentDetails();

    function displayDetails(data) {
        // Select the name input and set the value to data.studentName
        document.getElementById('Name').value = data.Name;
        // Select the StudentNumber and set the value to data.StudentNumber
        document.getElementById('StudentNumber').value = data.StudentNumber;
    }
 </script>
{% endblock script %}
