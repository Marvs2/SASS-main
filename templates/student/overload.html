{% extends "student/layout.html" %}
{% block content %}
<style>
    .form-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        margin: auto;
        max-width: 600px; /* Adjust the width as needed */
        padding: 20px;
    }

    /* Add other styles as needed */
</style>

<h1>Application for Overload of Subjects</h1>
<p>Process a request for the overload of subjects for students who intend to add additional subjects, more than the prescribed number of units specified in the curriculum for the current semester, prior to the opening of classes or within the adjustment period specified in the University calendar, and approved by the Director/Head of Academic Program.</p>

<p>Request for overload may be allowed for graduating students during the last school term. For undergraduate students, overload may be allowed under the following considerations:</p>

<ul>
    <li>Academically outstanding student as certified by the Director/Head of Academic Program.</li>
    <li>Transferee/Shiftiee who is in good standing (no failing grade in the previous semester).</li>
</ul>
<br>
{% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
            <div id="successAlert" class="alert alert-success alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="handleAlertClose()">
                    <span aria-hidden="true">Ã—</span>
                </button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

    <h2>Application Form</h2>
    <form action="{{ url_for('submit_overload_application')}}" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()" class="application-form">
        <label for="StudentNumber">Student Number:</label><br>
        <input type="text" id="StudentNumber" name="StudentNumber" required onblur="getStudentNumber()"><br><br>

        <!-- Display student name dynamically -->
        <label for="Name">Student Name:</label><br>
        <input type="text" id="Name" name="Name" required><br><br>
        <label for="programcourse">Select Program:</label><br>
<select id="programcourse" name="programcourse" required>
    <option value="">Select Program</option>
    <option value="BSIT">BACHELOR OF SCIENCE IN INFORMATION TECHNOLOGY</option>
    <option value="BBTLE_HE">BACHELOR OF BUSINESS TECHNOLOGY AND LIVELIHOOD EDUCATION - MAJOR IN HOME ECONOMICS</option>
    <option value="BBTLE_ICT">BACHELOR OF BUSINESS TECHNOLOGY AND LIVELIHOOD EDUCATION - MAJOR IN INFORMATION AND COMMUNICATION TECHNOLOGY</option>
    <option value="BSBA_MM">BACHELOR OF SCIENCE IN BUSINESS ADMINISTRATION - MAJOR IN MARKETING MANAGEMENT</option>
    <option value="BSBA_HRM">BACHELOR OF SCIENCE IN BUSINESS ADMINISTRATION - MAJOR IN HUMAN RESOURCE MANAGEMENT</option>
    <option value="BSE">BACHELOR OF SCIENCE IN ENTREPRENEURSHIP</option>
    <option value="DOMT_MOM">DIPLOMA IN OFFICE MANAGEMENT TECHNOLOGY WITH SPECIALIZATION IN MEDICAL OFFICE MANAGEMENT</option>
    <option value="BPA_PFM">BACHELOR OF PUBLIC ADMINISTRATION - MAJOR IN PUBLIC FINANCIAL MANAGEMENT</option>
</select><br><br>


        <label for="semester">Semester:</label><br>
        <select id="semester" name="semester" required>
            <option value="First">1st</option>
            <option value="Second">2nd</option>
            <option value="Summer">Summer</option>
        </select><br><br>

        <label for="subjectsToAdd">Subjects to Add (comma-separated):</label><br>
        <input type="text" id="subjectsToAdd" name="subjectsToAdd" required><br><br>

        <label for="justification">Justification for Overload:</label><br>
        <textarea id="justification" name="justification" rows="4" required></textarea><br><br>

        <input type="file" name="file"> <!-- File input field -->
        <br>
        <br>
        <label for="user_responsible">User Responsible:</label>
        <select id="user_responsible" name="user_responsible" required>
            <option value="Director">Director</option>
            <option value="Head of Academic Program">Head of Academic Program</option>
        </select><br><br>
        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="Sent" selected>Sending</option>
            <option value="Pending" disabled>Pending</option>
            <option value="Approved" disabled>Approved</option>
            <option value="Rejected" disabled>Rejected</option>
        </select><br><br>

        <button type="submit">Send Application</button>
    </form>

<script>
    setTimeout(function() {
        $('.alert').alert('close');
    }, 3000);
    // Form submission logic
    $('#overloadApplicationForm').submit(function(event) {
        const StudentNumber = $('#StudentNumber').val().trim();
        const Name = $('#Name').val().trim();
        const programcourse = $('#programcourse').val();
        const semester = $('#semester').val().trim();
        const subjectsToAdd = $('#subjectsToAdd').val().trim();
        const justification = $('#justification').val().trim();
        const userResponsible = $('#user_responsible').val().trim();
        const status = $('#status').val().trim();

        // Additional validation logic
        if (!StudentNumber || !Name || !programcourse || !semester || !subjectsToAdd || !justification) {
            alert('Please fill out all fields and provide valid values.');
            event.preventDefault(); // Prevent form submission
        }
// Prevent default form submission
    });
    function validateForm() {
            var StudentNumber = document.getElementById('StudentNumber').value;
            var studentName = document.getElementById('Name').value;
            var programcourse = document.getElementById('programcourse').value;
            var semester = document.getElementById('semester')
            var subjectsToAdd = document.getElementById('subjectsToAdd').value;
            

            if (!StudentNumber || !Name || !programcourse || !semester) {
                console.error('Error: Please fill out all required fields.');
                return false;
            }

            return true;
        }
</script>

{% endblock content %}

{% block script %}
 <script>
    // Fetch student details
    async function fetchStudentDetails() {
        try {
            const response = await fetch(`${api_base_url}/student-details`);

            if (!response.ok) {
                throw new Error(`Failed to fetch data. Server returned ${response.status}`);
            }

            const data_student_details = await response.json();
            console.log('data_student_details:', data_student_details);
            displayDetails(data_student_details);
        } catch (error) {
            console.error('Error fetching student details:', error.message);
        }
    }

    fetchStudentDetails();

    function displayDetails(data) {
        // Select the name input and set the value to data.studentName
        document.getElementById('Name').value = data.Name;
        // Select the StudentNumber and set the value to data.StudentNumber
        document.getElementById('StudentNumber').value = data.StudentNumber;
    }
 </script>
{% endblock script %}
