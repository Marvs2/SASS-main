{% extends "student/layout.html" %}

{% block content %}
<h1>Application for Cross Enrollment</h1>
<p>Process requests for cross-enrollment of subjects not offered for the current semester in the branch/campus. Permission must be obtained from the University Registrar, indicating the total number of units and the subject/s that the student is authorized to take from another school.</p>

<h2>Checklist of Requirements:</h2>
<ul>
    <li>Application Letter for Cross-Enrollment.</li>
    <li>Permit to Cross-Enroll from the Office of the University Registrar.</li>
</ul>
<br>

{% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">Ã—</span>
                </button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}
<br>

<h2>Application Form</h2>
<form id="crossEnrollmentForm" action="{{ url_for('submit_cross_enrollment') }}" method="POST" enctype="multipart/form-data">
    <label for="StudentNumber">Student ID:</label><br>
    <input type="text" id="StudentNumber" name="StudentNumber" required><br><br>

    <label for="Name">Student Name:</label><br>
    <input type="text" id="Name" name="Name" required><br><br>

    <label for="crossEnrollmentSchool">School for Cross-Enrollment:</label><br>
    <input type="text" id="crossEnrollmentSchool" name="crossEnrollmentSchool" required><br><br>

    <label for="crossEnrollmentUnits">Total Number of Units:</label><br>
    <input type="number" id="crossEnrollmentUnits" name="crossEnrollmentUnits" required><br><br>

    <label for="authorizedSubjects">Authorized Subjects to Take:</label><br>
    <textarea id="authorizedSubjects" name="authorizedSubjects" rows="4" cols="50" required></textarea><br><br>

    <label for="applicationLetter">Application Letter for Cross-Enrollment:</label><br>
    <input type="file" id="applicationLetter" name="applicationLetter" required><br><br>

    <label for="permitToCrossEnroll">Permit to Cross-Enroll from the Office of the University Registrar:</label><br>
    <input type="file" id="permitToCrossEnroll" name="permitToCrossEnroll" required><br><br>

    <label for="user_responsible">User Responsible:</label>
    <select id="user_responsible" name="user_responsible" required>
        <option value="Student Services">Student Services</option>
        <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
        <option value="Branch">Branch Registrar</option>
    </select><br><br>
    
    <label for="status">Status:</label>
    <select id="status" name="status">
        <option value="Sent" selected>Sending</option>
        <option value="Pending" disabled>Pending</option>
        <option value="Approved" disabled>Approved</option>
        <option value="Rejected" disabled>Rejected</option>
    </select><br><br>

    <button type="submit">Submit Application</button>
</form>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(document).ready(function() {
        // Automatically close the alert messages after 3 seconds
        setTimeout(function() {
            $('.alert').alert('close');
        }, 3000);

        // Form submission logic
        $('#crossEnrollmentForm').submit(function(event) {
            const studentID = $('#StudentNumber').val().trim();
            const Name = $('#Name').val().trim();
            const schoolForCrossEnrollment = $('#crossEnrollmentSchool').val().trim();
            const totalUnits = $('#crossEnrollmentUnits').val().trim();
            const authorizedSubjects = $('#authorizedSubjects').val().trim();

            if (!studentID || !name || !schoolForCrossEnrollment || totalUnits <= 0 || !authorizedSubjects) {
                alert('Please fill out all fields and provide valid values.');
                event.preventDefault();  // Prevent form submission
            }

            // Additional validation logic can be added here
        });
    });
</script>

{% endblock content %}

{% block script %}
 <script>
    // Fetch student details
    async function fetchStudentDetails() {
        try {
            const response = await fetch(`${api_base_url}/student-details`);

            if (!response.ok) {
                throw new Error(`Failed to fetch data. Server returned ${response.status}`);
            }

            const data_student_details = await response.json();
            console.log('data_student_details:', data_student_details);
            displayDetails(data_student_details);
        } catch (error) {
            console.error('Error fetching student details:', error.message);
        }
    }

    fetchStudentDetails();

    function displayDetails(data) {
        // Select the name input and set the value to data.studentName
        document.getElementById('Name').value = data.Name;
        // Select the StudentNumber and set the value to data.StudentNumber
        document.getElementById('StudentNumber').value = data.StudentNumber;
    }
 </script>
{% endblock script %}
