{% extends "student/layout.html" %}

{% block content %}

    <h1>Online Request for Tutorial of Subject</h1>
    <p>Process online requests for the tutorial of a subject not offered for the current semester. A retake of a subject by less than the minimum (35) number of students shall be endorsed by the Director/Head of Academic Program to the Office of the Vice President for Branches and Campuses for approval as a tutorial.</p>

    <h2>Checklist of Requirements:</h2>
    <ul>
        <li>Online Petition of Subject from <a href="https://sis1.pup.edu.ph/">https://sis1.pup.edu.ph/</a></li>
    </ul>

    <br>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <br>
    <br>
    <div class="form-container">
        <h2>Request Form</h2>
        <form id="tutorialForm" action="{{ url_for('submittutorialrequest')}}" method="POST" enctype="multipart/form-data">
            <label for="StudentNumber">Student Number:</label>
            <input type="text" id="StudentNumber" name="StudentNumber" required><br><br>

            <label for="Name">Student Name:</label>
            <input type="text" id="Name" name="Name" required><br><br>
        
            <label for="subject_code">Subject Code:</label>
            <input type="text" id="subject_code" name="subject_code" required><br><br>
        
            <label for="subject_name">Subject Name:</label>
            <input type="text" id="subject_name" name="subject_name" required><br><br>
        
            <label for="file">File:</label>
            <input type="file" id="file" name="file" required><br><br>
        
            <label for="user_responsible">User Responsible:</label>
            <select id="user_responsible" name="user_responsible" required>
                <option value="-Director/ Head of Academic Program">
                    -Director/ Head of Academic Program
                </option>
                <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
                <option value="Administrative Staff ICT Office">Administrative Staff ICT Office</option>
            </select><br><br>
        
            <label for="status">Status:</label>
            <select id="status" name="status">
                <option value="Sent" selected>Sending</option>
                <option value="Pending" disabled>Pending</option>
                <option value="Approved" disabled>Approved</option>
                <option value="Rejected" disabled>Rejected</option>
            </select><br><br>
        
            <input type="submit" value="Submit">
        </form>
    </div>

    <script>
        const form = document.getElementById('tutorialForm');
        form.addEventListener('submit', function(event) {
            const StudentNumber = document.getElementById('StudentNumber').value.trim();
            const Name = document.getElementById('Name').value.trim();
            const subjectCode = document.getElementById('subject_code').value.trim();
            const subjectName = document.getElementById('subject_name').value.trim();
            const file = document.getElementById('file').files[0];
            const userResponsible = document.getElementById('user_responsible').value.trim();

            if (!StudentNumber || !studentName || !subjectCode || !subjectName || !file || !userResponsible) {
                alert('Please fill out all fields.');
                event.preventDefault();
            }
            // You can add additional validation logic here if needed
        });
    </script>
{% endblock content%}

{% block script %}
 <script>
    // Fetch student details
    async function fetchStudentDetails() {
        try {
            const response = await fetch(`${api_base_url}/student-details`);

            if (!response.ok) {
                throw new Error(`Failed to fetch data. Server returned ${response.status}`);
            }

            const data_student_details = await response.json();
            console.log('data_student_details:', data_student_details);
            displayDetails(data_student_details);
        } catch (error) {
            console.error('Error fetching student details:', error.message);
        }
    }

    fetchStudentDetails();

    function displayDetails(data) {
        // Select the name input and set the value to data.studentName
        document.getElementById('Name').value = data.Name;
        // Select the StudentNumber and set the value to data.StudentNumber
        document.getElementById('StudentNumber').value = data.StudentNumber;
    }
 </script>
{% endblock script %}
