{% extends "student/layout.html" %}

{% block content %}

  <!-- Progress bar -->
  <div class="progressbar">
    <div class="progress1" id="progress1"></div>
    <div class="progress-step progress-step-active" data-title="Current Subjects"></div>
    <div class="progress-step" data-title="Change Subject/s"></div>
    <div class="progress-step" data-title="Payment"></div>
    <div class="progress-step" data-title="Review Subject"></div>
  </div>

  <!-- SHOW CURRENT SUBJECT -->
  <div class="form-step form-step-active">
    <div class="data data1" id="firstTableContainer">
      
      <div class="content-data">
        <div class="head mb-3">
          <h3>Change of Subject / Schedule - Current Subjects</h3>
        </div>

        <div class="row mb-3">
          <span class="mb-3">  
            <b>Student:</b>
            <input type="text" class="form-control" name="Name" title="Name" id="Name" readonly>
          </input>
          </span>

          <span>
            <b>Course:</b> {% if course %} {{ course.CourseCode }} {% endif %}
          </span>
        </div>

        <!-- <table id="addingSubject" class="table table-bordered table-condensed display">
          <thead>
            <tr>
              <th>Subject Code</th>
              <th>Subject Name</th>
              <th>Description</th>
              <th>Units</th>
            </tr>
          </thead>
          <tbody>
            {% for subject in subject_list %}
              <tr
                data-subject-code="{{ subject.SubjectCode }}"
                data-subject-description="{{ subject.Name }}"
                data-Description="{{ subject.Description }}"
                data-Units="{{ subject.Units }}"
                data-IsNSTP="{{ subject.IsNSTP }}"
              >
                <td>{{ subject.SubjectCode }}</td>
                <td>{{ subject.Name }}</td>
                <td>{{ subject.Description }}</td>
                <td>{{ subject.Units }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table> -->
        <div id="subjectsContainer"></div>
        <div class="d-flex justify-content-end mt-3">
          <button type="button" class="btn btn-primary btn-next">Next</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SHOW OPTION FOR ADDING OF SUBJECTS  -->

  <div class="form-step">
    <div class="data data1"  id="reviewHeading">
      <div class="content-data">
        <div class="head mb-3">
          <b>FROM:</b>
        </div>

        <!-- Review Table for Selected Subjects -->
        <table class="table table-bordered table-condensed" id="reviewSubjectsTable">
          <thead>
            <tr>
              <th></th>
              <th>Subject Code</th>
              <th>Subject Name</th>
              <th>Description</th>
              <th>Units</th>
            </tr>
          </thead>
          <tbody>
            <!-- Selected subjects will be added here -->
          </tbody>
        </table>
      </div>
      </div>

      <div class="data data1" id="selectHeading">
        <div class="content-data">
          <div class="head mb-3">
            <b>TO:</b>
          </div>
  
          <!-- Dropdown for Selecting Subjects -->
            <select id="selectedSubjectsDropdown" title="select" class="form-control" onchange="handleDropdownChange(this);">
                <option value="" selected disabled>Select a Subject</option>
                {% for selections in selection_list %}
                <option value="{{ selections.SubjectCode }}">
                    {{ selections.SubjectCode }} - {{ selections.Name }}
                </option>
                {% endfor %}
            </select>
        </div>
    </div>
  
      <div class="data data1">
        <div class="content-data">

        <div class="head mb-3">
          <h3>Change of Schedule/Subjects</h3>
        </div>
          <!-- Table for Displaying Subjects to Select -->
          <table id="selectedSubjectsTable" class="table table-bordered table-condensed">
            <thead>
              <tr>
                <th></th>
                <th>Subject Code</th>
                <th>Subject Name</th>
                <th>Description</th>
                <th>Units</th>
              </tr>
            </thead>
            <tbody>
                {% for subject in subject_list %}
                <tr
                data-subject-code="{{ subject.SubjectCode }}"
                data-subject-description="{{ subject.Name }}"
                data-Description="{{ subject.Description }}"
                data-Units="{{ subject.Units }}"
                data-IsNSTP="{{ subject.IsNSTP }}">
                  <td>
                    <div class="custom-control custom-checkbox">
                      <input type="checkbox" name="checkbox" title="checkbox" class="custom-control-input selections-checkbox" id="checkbox{{ subject_list.SubjectId }}" onclick="handleCheckboxClick(this);"/>

                      <label class="custom-control-label" for="checkbox{{ subject_list.SubjectId }}"></label>
                    </div>
                  </td>
                  <td>{{ subject.SubjectCode }}</td>
                  <td>{{ subject.Name }}</td>
                  <td>{{ subject.Description }}</td>
                  <td>{{ subject.Units }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

          <div class="d-flex justify-content-end mt-3">
            <button type="button" class="btn btn-primary btn-prev">Previous</button>
            <button type="button" class="btn btn-primary btn-next ml-2">Next</button>
          </div>
      </div>
    </div>
  </div>

  <!-- PAYMENT-->
  <div class="form-step">
    <div class="data data1">
      <div class="content-data">
        <div class="head mb-5">
          <h3 id="user-info">Payment</h3>
        </div>

        <form>
          <div class="row mb-5">
            <label for="name" class="col-sm-2 col-form-label">Sender Name</label>
            <div class="col-sm-8">
            <input type="text" class="form-control" id="name" name="name" required>
          </div>
          </div>

          <div class="row mb-5">
            <label for="MobileNumber" class="col-sm-2 col-form-label">Number</label>
            <div class="col-sm-8">
              <input type="text" class="form-control" name="MobileNumber" id="MobileNumber" required="required" maxlength="11" pattern="\d{11}">
          </div>
          </div>
        
          <div class="row mb-5">
            <label for="paymentScreenshot" class="col-sm-2 col-form-label">Proof of Payment</label>
            <div class="col-sm-8">
              <input type="file" class="form-control" id="paymentScreenshot" name="paymentScreenshot" accept="image/*" required>
          </div>
          </div>
      
          <!-- <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="agreeTerms" name="agreeTerms">
            <label class="form-check-label" for="agreeTerms">I agree to the terms and conditions</label>
          </div>          -->
        </form>        

        <div class="d-flex justify-content-end mt-3">
          <button type="button" class="btn btn-primary btn-prev">Previous</button>
          <button type="button" class="btn btn-primary btn-next ml-2"  onclick="showResponse()">Next</button>
        </div>
        
      </div>
    </div>
  </div>

<!-- REVIEW TRANSACTIONS -->
<div class="form-step">
  <div class="data data1">
    <div class="content-data">
      <div class="head mb-5">
        <h3>Review Transactions</h3>
      </div>

      <form id="serviceRequestForm" action="{{url_for('changeApplication')}}" method="POST" enctype="multipart/form-data">
      <!-- Hidden field for student ID (assuming it's available in the session or a similar context) -->
      <input type="hidden" name="StudentId" title="text" value="{{ session['user_id'] }}"/>
      <input type="hidden" id="fromSubjectsHidden" title="text" name="fromSubjects" value="">
      <input type="hidden" id="toSubjectsHidden" title="text" name="toSubjects" value="">
      <input type="hidden" id="selectedSubjects" title="text" name="selectedSubjects" value="">
      <input type="hidden" id="SenderNameHidden" title="text" name="SenderName" value="">
      <input type="hidden" id="SenderContactNoHidden" title="text" name="SenderContactNo" value="">
      <input type="hidden" id="PaymentFileHidden" title="text" name="PaymentFile" value="">

      <div class="row mb-5">
        <label for="reviewSubjectList" class="col-sm-2 col-form-label">From</label>
        <div class="col-sm-8">
        <span id="reviewSubjectList" class="form-control"></span>
      </div>
      </div>

      <div class="row mb-5">
        <label for="toSubject" class="col-sm-2 col-form-label">To</label>
        <div class="col-sm-8">
        <span id="toSubject" class="form-control"></span>
      </div>
      </div>

      <div class="row mb-5">
        <label for="SenderName" class="col-sm-2 col-form-label">Sender Name</label>
        <div class="col-sm-8">
          <span id="SenderName" class="form-control"></span>
        </div>
      </div>

      <div class="row mb-5">
        <label for="SenderContactNo" class="col-sm-2 col-form-label">Number</label>
        <div class="col-sm-8">
          <span id="SenderContactNo" class="form-control"></span>
        </div>
      </div>

      <div class="row mb-5">
        <label for="PaymentFile" class="col-sm-2 col-form-label">Proof of Payment</label>
        <div class="col-sm-8">
          <span id="PaymentFile" class="form-control"></span>
        </div>
      </div>

      <div class="row mb-5">
        <label for="ServiceDetails" class="col-sm-2 col-form-label">Reason/s</label>
        <div class="col-sm-8">
          <input type="text" class="form-control" id="ServiceDetails" name="ServiceDetails" required>
        </div>
      </div>

      <div class="d-flex justify-content-end mt-3">
        <button type="button" class="btn btn-primary btn-prev">Previous</button>
        <button type="submit" class="btn btn-primary ml-2" onclick="submitForm()">Submit</button>
      </div>
    </form>
    </div>
  </div>
</div>


<script>
    var selectedSubjectIds = [];

    document.addEventListener('DOMContentLoaded', function () {
        function handleCheckboxClick(checkbox) {
            updateCheckboxState();
            handleFromSubjectDisplay();
            handleToSubjectDropdown();
        }

        var checkboxes = document.getElementsByClassName('selections-checkbox');
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].addEventListener('click', function () {
                handleCheckboxClick(this);
            });
        }

        function updateCheckboxState() {
            var checkboxes = document.querySelectorAll('#selectedSubjectsTable .selections-checkbox:checked');
            var totalUnits = 0;
            checkboxes.forEach(function (checkbox) {
                var units = parseInt(checkbox.closest('tr').getAttribute('data-Units'));
                totalUnits += units;
            });

            document.querySelectorAll('#selectedSubjectsTable .selections-checkbox').forEach(function (checkbox) {
                var units = parseInt(checkbox.closest('tr').getAttribute('data-Units'));
                if (!checkbox.checked && (totalUnits + units) > 6) {
                    checkbox.disabled = true;
                } else {
                    checkbox.disabled = false;
                }
            });
        }

        function handleFromSubjectDisplay() {
            // Update the "From" subjects text based on selected checkboxes
            var fromSubjects = [];
            document.querySelectorAll('#selectedSubjectsTable .selections-checkbox:checked').forEach(function (checkbox) {
                var tr = checkbox.closest('tr');
                var subjectCode = tr.getAttribute('data-subject-code');
                var subjectName = tr.getAttribute('data-subject-description');
                fromSubjects.push(`${subjectCode} - ${subjectName}`);
            });
            document.getElementById('reviewSubjectList').textContent = fromSubjects.join(', ');
            document.getElementById('fromSubjectsHidden').value = fromSubjects.join(','); // Update hidden field
        }

        function handleToSubjectDropdown() {
            var toSubjectDropdown = document.getElementById('selectedSubjectsDropdown');
            var selectedSubjects = document.querySelectorAll('#selectedSubjectsTable .selections-checkbox:checked');
            var options = toSubjectDropdown.options;

            // Reset previous selections
            for (var i = 1; i < options.length; i++) {
                options[i].disabled = false;
            }

            // Disable options that are already selected
            selectedSubjects.forEach(function (checkbox) {
                var subjectCode = checkbox.closest('tr').getAttribute('data-subject-code');
                for (var i = 1; i < options.length; i++) {
                    if (options[i].value === subjectCode) {
                        options[i].disabled = true;
                    }
                }
            });
        }

        updateCheckboxState();
    });

    function handleCheckboxClick(checkbox) {
        var reviewSubjectsTable = document.getElementById('reviewSubjectsTable');
        var reviewHeading = document.getElementById('reviewHeading');
        var reviewTableBody = reviewSubjectsTable.getElementsByTagName('tbody')[0];
        var tr = checkbox.closest('tr');

        if (checkbox.checked) {
            var clonedRow = tr.cloneNode(true);
            clonedRow.querySelector('input[type="checkbox"]').onclick = function () {
                handleCheckboxClick(this);
            };
            reviewTableBody.appendChild(clonedRow);
            reviewSubjectsTable.style.display = 'table';
            tr.style.display = 'none';

            reviewHeading.style.display = 'block';

            var subjectId = checkbox.id.replace('checkbox', '');
            var subjectCode = tr.getAttribute('data-subject-code');
            var subjectName = tr.getAttribute('data-subject-description');
            selectedSubjectIds.push(subjectId);
            document.getElementById('selectedSubjects').value = selectedSubjectIds.join(',');

            var reviewSubjectList = document.getElementById('reviewSubjectList');
            var listItem = document.createElement('li');
            listItem.textContent = `${subjectCode} - ${subjectName}`;
            reviewSubjectList.appendChild(listItem);
        } else {
            Array.from(reviewTableBody.getElementsByTagName('tr')).forEach(function (row) {
                if (row.querySelector('input[type="checkbox"]').id === checkbox.id) {
                    reviewTableBody.removeChild(row);
                }
            });

            tr.style.display = '';

            var indexToRemove = selectedSubjectIds.indexOf(checkbox.id);
            if (indexToRemove !== -1) {
                selectedSubjectIds.splice(indexToRemove, 1);
                document.getElementById('selectedSubjects').value = selectedSubjectIds.join(',');
            }

            var reviewSubjectList = document.getElementById('reviewSubjectList');
            reviewSubjectList.removeChild(reviewSubjectList.lastChild);
        }

        updateCheckboxState();

        if (reviewTableBody.getElementsByTagName('tr').length === 0) {
            reviewSubjectsTable.style.display = 'none';
            reviewHeading.style.display = 'none';
        }

        handleFromSubjectDisplay();
        handleToSubjectDropdown();
    }

    function toggleDropdownVisibility() {
        var checkboxes = document.querySelectorAll('#addingSubject .selections-checkbox:checked');
        var selectedSubjectsDropdown = document.getElementById('selectedSubjectsDropdown');
        var selectHeading = document.getElementById('selectHeading');

        if (checkboxes.length > 0) {
            selectHeading.style.display = 'block';
        } else {
            selectHeading.style.display = 'none';
        }
    }

    var checkboxesAddingSubject = document.querySelectorAll('#addingSubject .selections-checkbox');
    for (var i = 0; i < checkboxesAddingSubject.length; i++) {
        checkboxesAddingSubject[i].addEventListener('click', function () {
            handleCheckboxClick(this);
            toggleDropdownVisibility();
        });
    }

    function showResponse() {
        var reviewSubjectList = document.getElementById('reviewSubjectList');
        var senderName = document.getElementById('name').value;
        var mobileNumber = document.getElementById('MobileNumber').value;
        var proofOfPaymentInput = document.getElementById('paymentScreenshot');
        var proofOfPaymentFileName = proofOfPaymentInput.value.split('\\').pop();
        var proofOfPaymentFilePath = proofOfPaymentInput.files[0];

        document.getElementById('SenderName').textContent = senderName;
        document.getElementById('SenderContactNo').textContent = mobileNumber;
        document.getElementById('SenderNameHidden').value = senderName;
        document.getElementById('SenderContactNoHidden').value = mobileNumber;

        if (proofOfPaymentFilePath) {
            var proofOfPaymentLink = document.createElement('a');
            proofOfPaymentLink.textContent = proofOfPaymentFileName;
            proofOfPaymentLink.href = URL.createObjectURL(proofOfPaymentFilePath);
            proofOfPaymentLink.target = '_blank';

            document.getElementById('PaymentFile').innerHTML = '';
            document.getElementById('PaymentFile').appendChild(proofOfPaymentLink);
            document.getElementById('PaymentFileHidden').value = proofOfPaymentFileName;
        }

        var selectedSubjects = [];
        document.querySelectorAll('#reviewSubjectsTable .selections-checkbox:checked').forEach(function (checkbox) {
            var tr = checkbox.closest('tr');
            var subjectCode = tr.getAttribute('data-subject-code');
            var subjectName = tr.getAttribute('data-subject-description');
            selectedSubjects.push(`${subjectCode} - ${subjectName}`);
        });
        document.getElementById('selectedSubjects').value = selectedSubjects.join(',');

        reviewSubjectList.innerHTML = '';
        document.querySelectorAll('#reviewSubjectsTable .selections-checkbox:checked').forEach(function (checkbox, index) {
            var tr = checkbox.closest('tr');
            var subjectCode = tr.getAttribute('data-subject-code');
            var subjectName = tr.getAttribute('data-subject-description');
            var listItem = document.createElement('li');
            listItem.textContent = `${subjectCode} - ${subjectName}`;

            reviewSubjectList.appendChild(listItem);
        });
    }

    function handleDropdownChange(dropdown) {
        var selectedSubject = dropdown.options[dropdown.selectedIndex].text;
        document.getElementById('toSubject').textContent = selectedSubject;
        document.getElementById('toSubjectsHidden').value = selectedSubject; // Update hidden field
    }
</script>

<script>
  // Function to fetch data from the server
  function fetchSubjectsGrade() {
    fetch("/api/v1/student/currentsubject")
      .then((response) => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then((data) => {
        // Call a function to update the HTML content with the first entry's data
        if (data.length > 0) {
          updateSubjectsContent([data[0]]);
        }
      })
      .catch((error) => {
        console.error("Error fetching data:", error);
      });
  }

  // Function to update the HTML content with the first set of fetched data
  function updateSubjectsContent(data) {
    var subjectsContainer = document.getElementById("subjectsContainer");
    subjectsContainer.innerHTML = "";

    var classGroup = data[0]; // Process only the first entry
    var classGroupDiv = document.createElement("div");
    classGroupDiv.className = "class-group";

    // Check if current entry is the first entry
    const isGPAZero = 0 === 0; // Always true for the first entry
    const gpaDisplay = isGPAZero ? "0.00" : classGroup.GPA;
    var classGroupInfo = document.createElement("div");
    classGroupInfo.innerHTML = `<h4>School Year ${classGroup.Batch} ${
      classGroup.Semester === 1
        ? "(1st Semester)"
        : classGroup.Semester === 2
        ? "(2nd Semester)"
        : "(Summer Term)"
    }</h4>
                                <p>Scholastic Status: Continuing</p>
                                <p>Course Code & Description: ${
                                  classGroup.SecCode
                                } (QUEZON CITY CAMPUS)</p>
                                <p>GPA : 0.00 GPA</p>`; // Display GPA as 0.00
    classGroupInfo.className = "class-group-info";

    var subjectsDiv = document.createElement("div");
    var subjectsTable = document.createElement("table");
    subjectsTable.className = "table md:border md:border-1 p-2 md:my-4";

    var tableHeader = document.createElement("thead");
    var headerRow = document.createElement("tr");
    headerRow.innerHTML = `<th class="lg:w-2/12 md:w-4/12 mt-4 font-bold text-c1">Subject</th>
                           <th class="lg:w-4/12 md:w-4/12 mt-4 font-bold text-c1">Subject Code</th>
                           <th class="lg:w-2/12 md:w-4/12 mt-4 font-bold text-c1">Units</th>
                           <th class="lg:w-2/12 md:w-4/12 mt-4 font-bold text-c1">Grade</th>`;
    tableHeader.appendChild(headerRow);
    subjectsTable.appendChild(tableHeader);

    var tableBody = document.createElement("tbody");
    classGroup.Subject.forEach((subject) => {
      var gradeDisplay = isGPAZero ? "0.00" : subject.Grade;
      var row = document.createElement("tr");
      row.innerHTML = `<td class="lg:w-2/12 md:w-4/12 mt-4 border-b border-gray-300 py-2">${subject.Subject}</td>
      <td class="lg:w-4/12 md:w-4/12 mt-4 border-b border-gray-300 py-2">${subject.Code}</td>
      <td class="lg:w-4/12 md:w-4/12 mt-4 border-b border-gray-300 py-2">${subject.Units}</td>
      <td class="lg:w-2/12 md:w-4/12 mt-4 border-b border-gray-300 py-2">${gradeDisplay}</td>`; // Display Grade as N/A
      tableBody.appendChild(row);
    });

    subjectsTable.appendChild(tableBody);
    subjectsDiv.appendChild(subjectsTable);
    classGroupDiv.appendChild(classGroupInfo);
    classGroupDiv.appendChild(subjectsDiv);
    subjectsContainer.appendChild(classGroupDiv);
  }

  document.addEventListener("DOMContentLoaded", function () {
    fetchSubjectsGrade();
  });
</script>

<script>
  // Function to fetch data for the second set of subjects
  function fetchAdditionalSubjects() {
    fetch("/api/v1/student/currentsubject")
      .then((response) => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then((data) => {
        // Call a function to update the HTML content with the first entry's data
        if (data.length > 0) {
          updateAdditionalSubjectsContent(data);
        }
      })
      .catch((error) => {
        console.error("Error fetching additional subjects:", error);
      });
  }

  // Function to update the HTML content with the second set of fetched data
  function updateAdditionalSubjectsContent(data) {
    var additionalSubjectsContainer = document.getElementById("additionalSubjectsContainer");
    additionalSubjectsContainer.innerHTML = "";

    // Process each entry in the data
    data.forEach((entry) => {
      var classGroupDiv = document.createElement("div");
      classGroupDiv.className = "class-group";

      var classGroupInfo = document.createElement("div");
      classGroupInfo.innerHTML = `<h4>School Year ${entry.Batch} ${
        entry.Semester === 1
          ? "(1st Semester)"
          : entry.Semester === 2
          ? "(2nd Semester)"
          : "(Summer Term)"
      }</h4>
                                  <p>Scholastic Status: Continuing</p>
                                  <p>Course Code & Description: ${
                                    entry.SecCode
                                  } (QUEZON CITY CAMPUS)</p>
                                  <p>GPA : 0.00 GPA</p>`; // Display GPA as 0.00
      classGroupInfo.className = "class-group-info";

      var subjectsDiv = document.createElement("div");
      var subjectsTable = document.createElement("table");
      subjectsTable.className = "table md:border md:border-1 p-2 md:my-4";

      var tableHeader = document.createElement("thead");
      var headerRow = document.createElement("tr");
      headerRow.innerHTML = `<th class="lg:w-2/12 md:w-4/12 mt-4 font-bold text-c1">Subject</th>
                             <th class="lg:w-4/12 md:w-4/12 mt-4 font-bold text-c1">Subject Code</th>
                             <th class="lg:w-2/12 md:w-4/12 mt-4 font-bold text-c1">Units</th>
                             <th class="lg:w-2/12 md:w-4/12 mt-4 font-bold text-c1">Grade</th>`;
      tableHeader.appendChild(headerRow);
      subjectsTable.appendChild(tableHeader);

      var tableBody = document.createElement("tbody");
      entry.Subject.forEach((subject) => {
        var gradeDisplay = "0.00"; // Assuming 0.00 if data not available
        var row = document.createElement("tr");
        row.innerHTML = `<td class="lg:w-2/12 md:w-4/12 mt-4 border-b border-gray-300 py-2">${subject.Subject}</td>
        <td class="lg:w-4/12 md:w-4/12 mt-4 border-b border-gray-300 py-2">${subject.Code}</td>
        <td class="lg:w-4/12 md:w-4/12 mt-4 border-b border-gray-300 py-2">${subject.Units}</td>
        <td class="lg:w-2/12 md:w-4/12 mt-4 border-b border-gray-300 py-2">${gradeDisplay}</td>`; // Display Grade as N/A
        tableBody.appendChild(row);
      });

      subjectsTable.appendChild(tableBody);
      subjectsDiv.appendChild(subjectsTable);
      classGroupDiv.appendChild(classGroupInfo);
      classGroupDiv.appendChild(subjectsDiv);
      additionalSubjectsContainer.appendChild(classGroupDiv);
    });
  }

  document.addEventListener("DOMContentLoaded", function () {
    fetchAdditionalSubjects();
  });
</script>

  

{% endblock content %}

<!-- 
<script>
  // Function to update the state of the checkboxes and the "Add Subject" button
  function updateCheckboxState() {
    var checkboxes = document.querySelectorAll('#selectedSubjectsTable .selections-checkbox:checked');
    var totalUnits = 0;
    checkboxes.forEach(function (checkbox) {
      var units = parseInt(checkbox.closest('tr').getAttribute('data-Units'));
      totalUnits += units;
    });

    // Disable or enable checkboxes based on the total units
    document.querySelectorAll('#selectedSubjectsTable .selections-checkbox').forEach(function (checkbox) {
      var units = parseInt(checkbox.closest('tr').getAttribute('data-Units'));
      if (!checkbox.checked && (totalUnits + units) > 6) {
        checkbox.disabled = true;
      } else {
        checkbox.disabled = false;
      }
    });
  }

  // Function to handle the checkbox click and move rows to the review table
  function handleCheckboxClick(checkbox) {
    var reviewSubjectsTable = document.getElementById('reviewSubjectsTable');
    var reviewHeading = document.getElementById('reviewHeading'); // The h3 element
    var reviewTableBody = reviewSubjectsTable.getElementsByTagName('tbody')[0];
    var tr = checkbox.closest('tr');

    // Move the row to the review table if the checkbox is checked
    if (checkbox.checked) {
      var clonedRow = tr.cloneNode(true);
      clonedRow.querySelector('input[type="checkbox"]').onclick = function () { handleCheckboxClick(this); };
      reviewTableBody.appendChild(clonedRow);
      reviewSubjectsTable.style.display = 'table'; // Show the review table
      reviewHeading.style.display = 'block'; // Show the review heading

      // Hide the row in the second table
      tr.style.display = 'none';
    } else {
      // If unchecked, find the corresponding row in the review table and remove it
      Array.from(reviewTableBody.getElementsByTagName('tr')).forEach(function (row) {
        if (row.querySelector('input[type="checkbox"]').id === checkbox.id) {
          reviewTableBody.removeChild(row);
        }
      });

      // Show the row again in the second table
      tr.style.display = '';
    }

    // Update the state of checkboxes after any change
    updateCheckboxState();
  }

  // Function to handle the checkbox click in the review table and move rows back to the second table
  function handleReviewCheckboxClick(checkbox) {
    var selectedSubjectsTable = document.getElementById('selectedSubjectsTable');
    var selectedTableBody = selectedSubjectsTable.getElementsByTagName('tbody')[0];
    var reviewSubjectsTable = document.getElementById('reviewSubjectsTable');
    var reviewTableBody = reviewSubjectsTable.getElementsByTagName('tbody')[0];
    var tr = checkbox.closest('tr');

    // Move the row back to the second table if the checkbox is checked
    if (checkbox.checked) {
      var clonedRow = tr.cloneNode(true);
      clonedRow.querySelector('input[type="checkbox"]').onclick = function () { handleCheckboxClick(this); };
      selectedTableBody.appendChild(clonedRow);

      // Hide the row in the review table
      tr.style.display = 'none';
    } else {
      // If unchecked, find the corresponding row in the second table and remove it
      Array.from(selectedTableBody.getElementsByTagName('tr')).forEach(function (row) {
        if (row.querySelector('input[type="checkbox"]').id === checkbox.id) {
          selectedTableBody.removeChild(row);
        }
      });

      // Show the row again in the review table
      tr.style.display = '';
    }

    // Update the state of checkboxes after any change in both tables
    updateCheckboxState();
  }

  function showResponse() {
  // Clear existing data
  var FacultyRole = document.getElementById("FacultyRole");
  var reviewSubjectList = document.getElementById('reviewSubjectList');
  var reviewName = document.getElementById('SenderName');
  var reviewNumber = document.getElementById('SenderContactNo');
  var reviewProof = document.getElementById('PaymentFile');
  reviewSubjectList.innerHTML = '';

  var selectedSubjects = [];
  document.querySelectorAll('#reviewSubjectsTable .selections-checkbox:checked').forEach(function (checkbox) {
    var tr = checkbox.closest('tr');
    var subjectCode = tr.getAttribute('data-subject-code');
    selectedSubjects.push(subjectCode);
  });

  // Update the hidden input field with selected subjects
  document.getElementById('selectedSubjects').value = selectedSubjects.join(',');

  // Get selected subjects from the review table and display them
  document.querySelectorAll('#reviewSubjectsTable .selections-checkbox:checked').forEach(function (checkbox, index) {
    var tr = checkbox.closest('tr');
    var subjectCode = tr.getAttribute('data-subject-code');
    var subjectName = tr.getAttribute('data-subject-description');
    // var units = tr.getAttribute('data-Units');
    var listItem = document.createElement('li');
    listItem.textContent = `${subjectCode} - ${subjectName} `; //(${units} units)

    // Add padding below every two data items
    if (index === 0) {
      listItem.style.marginBottom = '10px'; // No margin between items
    }

    reviewSubjectList.appendChild(listItem);
  });

  // Get and display payment information
  reviewName.textContent = document.getElementById('name').value;
  reviewNumber.textContent = document.getElementById('MobileNumber').value;
  var proofFile = document.getElementById('paymentScreenshot').files[0];
  reviewProof.textContent = proofFile ? proofFile.name : 'No file chosen';

  // Display the information in the specified form
  document.getElementById('serviceRequestForm').style.display = 'block';

  }

  updateCheckboxState();

  function submitForm() {
    // Get data from the form
    var FacultyRole = document.getElementById('FacultyRole');
    var reviewSubjectList = document.getElementById('reviewSubjectList');
    var SenderName = document.getElementById('SenderName').textContent;
    var SenderContactNo = document.getElementById('SenderContactNo').textContent;
    var proofFileInput = document.getElementById('paymentScreenshot'); // Update the ID to match your file input
    var proofFile = proofFileInput.files[0];
    var ServiceDetails = document.getElementById('ServiceDetails').value;

    // Create FormData object and append form fields
    var formData = new FormData();
    
    formData.append("FacultyRole", FacultyRole);
    formData.append('reviewSubjects', reviewSubjectList.textContent);
    formData.append('SenderName', SenderName);
    formData.append('SenderContactNo', SenderContactNo);
    formData.append('paymentScreenshot', proofFile); // Update the key to match your server-side expectation
    formData.append('ServiceDetails', ServiceDetails);

    // You can use AJAX to send the data to the server
    // Example using jQuery AJAX:
    $.ajax({
      type: 'POST',
      url: '/student/addingsubject/submitapplication', // Update the URL to match your server endpoint
      data: formData,
      contentType: false,
      processData: false,
      success: function(response) {
        // Handle success response from the server
        console.log(response);
      },
      error: function(error) {
        // Handle error response from the server
        console.error(error);
      }
    });
  }
</script> -->





