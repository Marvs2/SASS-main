{% extends "student/layout.html" %}

{% block content %}
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
   

        
<div class="data data1">
    <div class="content-data">
        <div class="head">
            <h3>Application for Change of Schedule/Subjects</h3>           
        </div>

    <form action="{{ url_for('change_of_subjects') }}" method="POST" enctype="multipart/form-data">
        
        <div class="row mb-3">
            <label for="StudentNumber" class="col-sm-3 col-form-label">Student Number</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="StudentNumber" name="StudentNumber" readonly>
            </div>
        </div>

        <div class="row mb-3">
            <label for="Name" class="col-sm-3 col-form-label">Name</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="Name" name="Name" readonly>
            </div>
        </div>

        <div class="row mb-3">
            <label for="enrollment_type" class="col-sm-3 col-form-label">Enrollment Type</label>
                <div class="col-sm-8">
                    <select class="custom-select" id="enrollment_type" name="enrollment_type" required>
                        <option value="">Select Enrollment Type...</option>
                        <option value="Regular">Regular</option>
                        <option value="Irregular">Irregular</option>
                    </select>
                </div>
        </div>
        
        <div class="row mb-3">
            <label for="ace_form" class="col-sm-3 col-form-label">Certificate of Registration <br> (Current Semester) </label>
            <div class="col-sm-8">
                <input class="form-control" type="file" name="ace_form" id="ace_form" accept=".pdf">
              </div>
        </div>

        <div class="row mb-3">
            <label for="user_responsible" class="col-sm-3 col-form-label">User Responsible </label>
                <div class="col-sm-8">
                    <select class="custom-select" id="user_responsible" name="user_responsible" required>
                        <option value="Faculty Member/s">Faculty Member/s</option>
                        <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
                        <option value="CDO Cashier/Accounting">CDO Cashier/Accounting</option>
                        <option value="Registrar's Office">Registrar's Office</option>
                    </select>
                </div>
        </div>

        <div class="row mb-3">
            <label for="status" class="col-sm-3 col-form-label">Status </label>
                <div class="col-sm-8">
                    <select class="custom-select" id="status" name="status" required>
                        <option value="Sent" selected>Sending</option>
                        <option value="Pending" disabled>Pending</option>
                        <option value="Approved" disabled>Approved</option>
                        <option value="Rejected" disabled>Rejected</option>
                    </select>
                </div>
        </div>

         <div class="d-flex justify-content-center">
            <button type="submit" class="btn btn-success">Submit Application</button>
        </div>

    </form>

    </div>
</div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        function validateForm() {
            var StudentNumber = document.getElementById('StudentNumber').value;
            var studentName = document.getElementById('Name').value;
            if (!StudentNumber || !studentName) {
                alert('Error: Please fill out all required fields.');
                return false;
            }

            // Add additional validation checks here if needed

            return true;
        }

        function submitForm() {
            if (validateForm()) {
                // Set the value of the hidden input to the current date and time
                document.getElementById('created_at').value = new Date().toISOString();

                // Use AJAX to submit the form asynchronously
                $.ajax({
                    type: 'POST',
                    url: $('#changeSubjectsForm').attr('action'),
                    data: $('#changeSubjectsForm').serialize(),
                    success: function(response) {
                        // Handle success, e.g., display a success message
                        alert(response.message);
                        // Optionally, redirect to another page
                        window.location.href = '/success';  // Change to the desired URL
                    },
                    error: function(error) {
                        // Handle error, e.g., display an error message
                        alert('Error submitting the form. Please try again.');
                    }
                });

                return false;  // Prevent the form from submitting the traditional way
            }
        }
    </script>
{% endblock content %}

{% block script %}
 <script>
    // Fetch student details
    async function fetchStudentDetails() {
        try {
            const response = await fetch(`${api_base_url}/student-details`);

            if (!response.ok) {
                throw new Error(`Failed to fetch data. Server returned ${response.status}`);
            }

            const data_student_details = await response.json();
            console.log('data_student_details:', data_student_details);
            displayDetails(data_student_details);
        } catch (error) {
            console.error('Error fetching student details:', error.message);
        }
    }

    fetchStudentDetails();

    function displayDetails(data) {
        // Select the StudentNumber and set the value to data.StudentNumber
        document.getElementById('StudentNumber').value = data.StudentNumber;
        // Select the name input and set the value to data.Name
        document.getElementById('Name').value = data.Name;

    }
 </script>
{% endblock script %}
