{% extends "student/home.html" %}

{% block services %}
    <div style="display: flex; justify-content: space-between;">
        <div style="width: 48%;">
            <h1>Online Petition of Subject</h1>
            <p>Process online requests for the petition of back subjects or retakes of subjects not offered for the current semester. A minimum of 35 students must request the petition to be recommended by the Administrative Building Administrative Staff ICT Office and approved by the Office of the Vice President for Branches and Campuses.</p>
            <br>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">Ã—</span>
                            </button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <br>
            <br>
        
            <h2>Petition Form</h2>
            <form id="petitionForm" action="{{url_for('submit_petition')}}" method="POST" enctype="multipart/form-data">
                <label for="studentNumber">Student Number:</label><br>
                <input type="text" id="studentNumber" name="studentNumber" required><br><br>
        
                <label for="name">Student Name:</label><br>
                <input type="text" id="name" name="name" required><br><br>
        
                <label for="subjectCode">Subject Code:</label><br>
                <input type="text" id="subjectCode" name="subjectCode" required><br><br>
        
                <label for="subjectName">Subject Name:</label><br>
                <input type="text" id="subjectName" name="subjectName" required><br><br>
        
                <label for="petitionType">Petition Type:</label><br>
                <select id="petitionType" name="petitionType" required>
                    <option value="Back Subject">Back Subject</option>
                    <option value="Retake">Retake</option>
                    <!-- Add more options as needed -->
                </select><br><br>
        
                <label for="requestReason">Reason for Petition:</label><br>
                <textarea id="requestReason" name="requestReason" rows="4" cols="50" required></textarea><br><br>
        
                <label for="userResponsible">User Responsible:</label>
                <select id="userResponsible" name="userResponsible" required>
                    <option value="Director/ Head of Academic Program">Director/ Head of Academic Program</option>
                    <option value="Administrative Building Administrative Staff ICT Office">Administrative Building Administrative Staff ICT Office</option>
                </select><br><br>
        
                <label for="status">Status:</label>
                <select id="status" name="status">
                    <option value="Sent" selected>Sending</option>
                    <option value="Pending" disabled>Pending</option>
                    <option value="Approved" disabled>Approved</option>
                    <option value="Rejected" disabled>Rejected</option>
                </select><br><br>
        
                <button type="submit">Submit Petition</button>
            </form>
        
            <script>
                const form = document.getElementById('petitionForm');
                form.addEventListener('submit', function(event) {
                    const studentNumber = document.getElementById('studentNumber').value.trim();
                    const name = document.getElementById('name').value.trim();
                    const subjectCode = document.getElementById('subjectCode').value.trim();
                    const subjectName = document.getElementById('subjectName').value.trim();
                    const petitionType = document.getElementById('petitionType').value.trim();
                    const requestReason = document.getElementById('requestReason').value.trim();
                    const userResponsible = document.getElementById('userResponsible').value.trim();
        
                    if (!studentNumber || !name || !subjectCode || !subjectName || !petitionType || !requestReason || !userResponsible) {
                        alert('Please fill out all fields.');
                        event.preventDefault();
                    }
                    // You can add additional validation logic here if needed
                });
            </script>
        </div>
        <div style="width: 100%;">
            <!-- DataTable to display submitted petitions -->
            <h2>Submitted Petitions</h2>
            <table id="petitionsTable" class="display">
                <thead>
                    <tr>
                        <th>Student Number</th>
                        <th>Student Name</th>
                        <th>Subject Code</th>
                        <th>Subject Name</th>
                        <th>Petition Type</th>
                        <th>Reason</th>
                        <th>User Responsible</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for petition in petitions %}
                        <tr>
                            <td>{{ petition.studentNumber }}</td>
                            <td>{{ petition.student_name }}</td>
                            <td>{{ petition.subject_code }}</td>
                            <td>{{ petition.subject_name }}</td>
                            <td>{{ petition.petition_type }}</td>
                            <td>{{ petition.request_reason }}</td>
                            <td>{{ petition.user_responsible }}</td>
                            <td>{{ petition.status }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
            <script>
                $(document).ready(function () {
                    // Initialize DataTable
                    $('#petitionsTable').DataTable({
                        ajax: {
                            url: '{{ url_for("view_student_petition", student_id=student_id) }}',
 // ("get_petitions_data")Replace with your endpoint to fetch petition data
                            dataSrc: '', // Data source from the AJAX response
                        },
                        columns: [
                            { data: 'studentNumber' },
                            { data: 'name' },
                            { data: 'subjectCode' },
                            { data: 'subjectName' },
                            { data: 'petitionType' },
                            { data: 'requestReason' },
                            { data: 'userResponsible' },
                            { data: 'status' }
                        ]
                    });
                });
            </script>
    </div>

    <!-- Your petition form code -->
    <!-- ... -->
{% endblock %}
