{% extends "student/layout.html" %}

{% block content %}
    <div style="display: flex; justify-content: space-between;">
        <div style="width: 48%;">
            <h1>Online Petition of Subject</h1>
            <p>Process online requests for the petition of back subjects or retakes of subjects not offered for the current semester. A minimum of 35 students must request the petition to be recommended by the Administrative Building Administrative Staff ICT Office and approved by the Office of the Vice President for Branches and Campuses.</p>
            <br>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">Ã—</span>
                            </button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <br>
            <br>
        
            <h2>Petition Form</h2>
            <form id="petitionForm" action="{{url_for('submitpetition')}}" method="POST" enctype="multipart/form-data">
                <label for="StudentNumber">Student Number:</label><br>
                <input type="text" id="StudentNumber" name="StudentNumber" required><br><br>
        
                <label for="Name">Student Name:</label><br>
                <input type="text" id="Name" name="Name" required><br><br>
        
                <label for="subjectCode">Subject Code:</label><br>
                <input type="text" id="subjectCode" name="subjectCode" required><br><br>
        
                <label for="subjectName">Subject Name:</label><br>
                <input type="text" id="subjectName" name="subjectName" required><br><br>
        
                <label for="petitionType">Petition Type:</label><br>
                <select id="petitionType" name="petitionType" required>
                    <option value="Back Subject">Back Subject</option>
                    <option value="Retake">Retake</option>
                    <!-- Add more options as needed -->
                </select><br><br>
        
                <label for="requestReason">Reason for Petition:</label><br>
                <textarea id="requestReason" name="requestReason" rows="4" cols="50" required></textarea><br><br>
        
                <label for="userResponsible">User Responsible:</label>
                <select id="userResponsible" name="userResponsible" required>
                    <option value="Director/ Head of Academic Program">Director/ Head of Academic Program</option>
                    <option value="Administrative Building Administrative Staff ICT Office">Administrative Building Administrative Staff ICT Office</option>
                </select><br><br>
        
                <label for="status">Status:</label>
                <select id="status" name="status">
                    <option value="Sent" selected>Sending</option>
                    <option value="Pending" disabled>Pending</option>
                    <option value="Approved" disabled>Approved</option>
                    <option value="Rejected" disabled>Rejected</option>
                </select><br><br>
        
                <button type="submit">Submit Petition</button>
            </form>
        
            <script>
                $(document).ready(function () {
                    // Automatically close the alert messages after 3 seconds
                    setTimeout(function () {
                        $('.alert').alert('close');
                    }, 3000);

                const form = document.getElementById('petitionForm');
                form.addEventListener('submit', function(event) {
                    const StudentNumber = document.getElementById('StudentNumber').value.trim();
                    const Name = document.getElementById('Name').value.trim();
                    const subjectCode = document.getElementById('subjectCode').value.trim();
                    const subjectName = document.getElementById('subjectName').value.trim();
                    const petitionType = document.getElementById('petitionType').value.trim();
                    const requestReason = document.getElementById('requestReason').value.trim();
                    const userResponsible = document.getElementById('userResponsible').value.trim();
        
                    if (!StudentNumber || !Name || !subjectCode || !subjectName || !petitionType || !requestReason || !userResponsible) {
                        alert('Please fill out all fields.');
                        event.preventDefault();
                    }
                    // You can add additional validation logic here if needed
                });
            });
            </script>
        </div>

    <!-- Your petition form code -->
    <!-- ... -->
{% endblock content %}

{% block script %}
 <script>
    // Fetch student details
    async function fetchStudentDetails() {
        try {
            const response = await fetch(`${api_base_url}/student-details`);

            if (!response.ok) {
                throw new Error(`Failed to fetch data. Server returned ${response.status}`);
            }

            const data_student_details = await response.json();
            console.log('data_student_details:', data_student_details);
            displayDetails(data_student_details);
        } catch (error) {
            console.error('Error fetching student details:', error.message);
        }
    }

    fetchStudentDetails();

    function displayDetails(data) {
        // Select the name input and set the value to data.studentName
        document.getElementById('Name').value = data.Name;
        // Select the StudentNumber and set the value to data.StudentNumber
        document.getElementById('StudentNumber').value = data.StudentNumber;
    }
 </script>
{% endblock script %}
