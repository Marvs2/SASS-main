{% extends "student/layout.html" %}

{% block content %}
    <h1>Certification Request Form</h1>
    <p>Fill out the form below to submit a certification request.</p>

    <br>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <br>

    <form id="certificationRequestForm" action="{{ url_for('submit_certification_request') }}" method="POST" enctype="multipart/form-data">
        <label for="studentNumber">Student Number:</label>
        <input type="text" id="studentNumber" name="studentNumber" required><br>

        <label for="name">Student Name:</label>
        <input type="text" id="name" name="name" required><br>

        <label for="certification_type">Certification Type:</label>
        <input type="text" id="certification_type" name="certification_type" required><br>

        <label for="request_form_file">Request Form File:</label>
        <input type="file" id="request_form_file" name="request_form_file" required><br>

        <label for="identification_card_file">Identification Card File:</label>
        <input type="file" id="identification_card_file" name="identification_card_file" required><br>

        <label for="is_representative">Is there a representative?</label>
        <input type="checkbox" id="is_representative" name="is_representative"><br>

        <div id="representativeInfo" style="display: none;">
            <label for="authorizationLetter">Authorization Letter:</label><br>
            <input type="file" id="authorizationLetter" name="authorizationLetter"><br><br>

            <label for="representativeID">Representative's Identification Card (ID):</label><br>
            <input type="file" id="representativeID" name="representativeID"><br><br>
        </div><br><br>

        <label for="user_responsible">User Responsible:</label>
        <select id="user_responsible" name="user_responsible" required>
            <option value="Faculty">Faculty Member/s</option>
            <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
            <option value="CDO Cashier/Accounting Office">CDO Cashier/Accounting Office</option>
        </select><br>

        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="Sent" selected>Sending</option>
            <option value="Pending" disabled>Pending</option>
            <option value="Approved" disabled>Approved</option>
            <option value="Rejected" disabled>Rejected</option>
        </select><br>

        <button type="submit">Submit</button>
    </form>

    <script>
        const isRepresentativeCheckbox = document.getElementById('is_representative');
        const representativeInfoDiv = document.getElementById('representativeInfo');

        isRepresentativeCheckbox.addEventListener('change', function () {
            if (isRepresentativeCheckbox.checked) {
                representativeInfoDiv.style.display = 'block';
            } else {
                representativeInfoDiv.style.display = 'none';
            }
        });

        // Automatically close the alert messages after 3 seconds
        setTimeout(function () {
            $('.alert').alert('close');
        }, 3000);

        // JavaScript validation logic can be added here
        document.getElementById('certificationRequestForm').addEventListener('submit', function (event) {
        // Add your validation logic here
        var studentNumber = document.getElementById('studentNumber').value.trim();
        var name = document.getElementById('name').value.trim();
        var certificationType = document.getElementById('certification_type').value.trim();
        var requestFormFile = document.getElementById('request_form_file').value.trim();
        var identificationCardFile = document.getElementById('identification_card_file').value.trim();
        var isRepresentativeCheckbox = document.getElementById('is_representative');
        var authorizationLetterFile = document.getElementById('authorizationLetter').value.trim();
        var representativeIDFile = document.getElementById('representativeID').value.trim();

        if (!studentNumber || !name || !certificationType || !requestFormFile || !identificationCardFile) {
            alert('Please fill out all required fields.');
            event.preventDefault();  // Prevent form submission
        }

        if (isRepresentativeCheckbox.checked && (!authorizationLetterFile || !representativeIDFile)) {
            alert('Please provide files for the representative.');
            event.preventDefault();  // Prevent form submission
        }
    });
    </script>
{% endblock %}
