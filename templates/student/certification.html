{% extends "student/layout.html" %}

{% block content %}
    <h1>Certification Request Form</h1>
    <p>Fill out the form below to submit a certification request.</p>

    <br>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <br>

    <form id="certificationRequestForm" action="{{ url_for('submit_certification_request') }}" method="POST" enctype="multipart/form-data">
        <label for="StudentNumber">Student Number:</label>
        <input type="text" id="StudentNumber" name="StudentNumber" required><br>

        <label for="Name">Student Name:</label>
        <input type="text" id="Name" name="Name" required><br>

        <label for="certification_type">Certification Type:</label>
        <input type="text" id="certification_type" name="certification_type" required><br>

        <label for="request_form">Request Form File:</label>
        <input type="file" id="request_form" name="request_form" required><br>

        <label for="identification_card">Identification Card File:</label>
        <input type="file" id="identification_card" name="identification_card" required><br>

        <label for="is_representative">Is there a representative?</label>
        <input type="checkbox" id="is_representative" name="is_representative"><br>

        <div id="representativeInfo" style="display: none;">
            <label for="authorization_letter">Authorization Letter:</label><br>
            <input type="file" id="authorization_letter" name="authorization_letter"><br><br>

            <label for="representative_id">Representative's Identification Card (ID):</label><br>
            <input type="file" id="representative_id" name="representative_id"><br><br>
        </div><br><br>

        <label for="user_responsible">User Responsible:</label>
        <select id="user_responsible" name="user_responsible" required>
            <option value="Faculty">Faculty Member/s</option>
            <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
            <option value="CDO Cashier/Accounting Office">CDO Cashier/Accounting Office</option>
        </select><br>

        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="Sent" selected>Sending</option>
            <option value="Pending" disabled>Pending</option>
            <option value="Approved" disabled>Approved</option>
            <option value="Rejected" disabled>Rejected</option>
        </select><br>

        <button type="submit">Submit</button>
    </form>

    <script>
        const isRepresentativeCheckbox = document.getElementById('is_representative');
        const representativeInfoDiv = document.getElementById('representativeInfo');

        isRepresentativeCheckbox.addEventListener('change', function () {
            if (isRepresentativeCheckbox.checked) {
                representativeInfoDiv.style.display = 'block';
            } else {
                representativeInfoDiv.style.display = 'none';
            }
        });

        // Automatically close the alert messages after 3 seconds
        setTimeout(function () {
            $('.alert').alert('close');
        }, 3000);

        // JavaScript validation logic can be added here
        document.getElementById('certificationRequestForm').addEventListener('submit', function (event) {
        // Add your validation logic here
        var StudentNumber = document.getElementById('StudentNumber').value.trim();
        var Name = document.getElementById('Name').value.trim();
        var certificationType = document.getElementById('certification_type').value.trim();
        var request_form = document.getElementById('request_form').value.trim();
        var identification_card = document.getElementById('identification_card').value.trim();
        var isRepresentativeCheckbox = document.getElementById('is_representative');
        var authorization_letter = document.getElementById('authorization_letter').value.trim();
        var representative_id = document.getElementById('representative_id').value.trim();

        if (!StudentNumber || !Name || !certificationType || !requestFormFile || !identificationCardFile) {
            alert('Please fill out all required fields.');
            event.preventDefault();  // Prevent form submission
        }

        if (isRepresentativeCheckbox.checked && (!authorizationLetterFile || !representativeIDFile)) {
            alert('Please provide files for the representative.');
            event.preventDefault();  // Prevent form submission
        }
    });
    </script>
{% endblock %}

{% block script %}
 <script>
    // Fetch student details
    async function fetchStudentDetails() {
        try {
            const response = await fetch(`${api_base_url}/student-details`);

            if (!response.ok) {
                throw new Error(`Failed to fetch data. Server returned ${response.status}`);
            }

            const data_student_details = await response.json();
            console.log('data_student_details:', data_student_details);
            displayDetails(data_student_details);
        } catch (error) {
            console.error('Error fetching student details:', error.message);
        }
    }

    fetchStudentDetails();

    function displayDetails(data) {
        // Select the Name input and set the value to data.Name
        document.getElementById('Name').value = data.Name;
        // Select the StudentNumber and set the value to data.StudentNumber
        document.getElementById('StudentNumber').value = data.StudentNumber;
    }
 </script>
{% endblock script %}

