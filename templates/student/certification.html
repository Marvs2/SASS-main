{% extends "student/layout.html" %}
{% block content %}

<h1>Metadata Details</h1>

<input type="number" id="metadataIdInput" placeholder="Enter Metadata ID">
<button onclick="fetchMetadataDetails()">Get Details</button>

<table id="metadataDetailsTable">
    <thead>
        <tr>
            <th>Key</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be populated here -->
    </tbody>
</table>
<script>
    const api_base_url = '{{ api_base_url | default("") }}';
    console.log('api_base_url: ', api_base_url);

<<<<<<< HEAD
async function fetchMetadataDetails() {
    const metadataId = document.getElementById("metadataIdInput").value;
    if (!metadataId) {
        alert("Please enter a Metadata ID");
        return;
    }
=======
                <div class="row mb-3">
                    <label for="CertificationType" class="col-sm-3 col-form-label">Certification Type</label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="CertificationType" name="CertificationType">
                    </div>
                </div>
>>>>>>> TEST

    try {
        const response = await fetch(`${api_base_url}/api/get_metadata_details/${MetadataId}`);

<<<<<<< HEAD
        if (!response.ok) {
            throw new Error(`Failed to fetch data. Server returned ${response.status}`);
=======
                <div class="row mb-3">
                    <label for="identification_card" class="col-sm-3 col-form-label">Certificate of Registration <br> (Current Semester) </label>
                    <div class="col-sm-8">
                        <input type="file" class="form-control" name="identification_card" id="identification_card" accept=".pdf">
                      </div>
                </div>

                <label for="IsRepresentative">Is there a representative?</label>
                <input type="checkbox" id="IsRepresentative" name="IsRepresentative"><br>

                <div class="row mb-3" id="representativeInfo">
                    <label for="authorization_letter" class="col-sm-3 col-form-label">Authorization Letter</label>
                    <div class="col-sm-8">
                        <input type="file" class="form-control" name="authorization_letter" id="authorization_letter">
                      </div>

                      <label for="representative_id" class="col-sm-3 col-form-label">Representative's Identification Card (ID)</label>
                      <div class="col-sm-8">
                          <input type="file" class="form-control" name="representative_id" id="representative_id">
                        </div>                   
                </div>

                <div class="row mb-3">
                    <label for="UserResponsible" class="col-sm-3 col-form-label">User Responsible </label>
                        <div class="col-sm-8">
                            <select class="custom-select" id="UserResponsible" name="UserResponsible" required>
                                <option value="Faculty">Faculty Member/s</option>
                                <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
                                <option value="CDO Cashier/Accounting Office">CDO Cashier/Accounting Office</option>
                            </select>
                        </div>
                </div>
    
                <div class="row mb-3" style="display: none;">
                    <label for="Status" class="col-sm-3 col-form-label">Status </label>
                    <div class="col-sm-8">
                        <select class="custom-select" id="Status" name="Status" required>
                            <option value="Sent" selected>Sending</option>
                            <option value="Pending" disabled>Pending</option>
                            <option value="Approved" disabled>Approved</option>
                            <option value="Rejected" disabled>Rejected</option>
                        </select>
                    </div>
                </div>
    
                 <div class="d-flex justify-content-center">
                    <button type="submit" class="btn btn-success">Submit Application</button>
                </div>
            </form>
           
        </div>
    </div>

    <script>
        const isRepresentativeCheckbox = document.getElementById('IsRepresentative');
        const representativeInfoDiv = document.getElementById('representativeInfo');

        isRepresentativeCheckbox.addEventListener('change', function () {
            if (isRepresentativeCheckbox.checked) {
                representativeInfoDiv.style.display = 'block';
            } else {
                representativeInfoDiv.style.display = 'none';
            }
        });

        // Automatically close the alert messages after 3 seconds
        setTimeout(function () {
            $('.alert').alert('close');
        }, 3000);

        // JavaScript validation logic can be added here
        document.getElementById('certificationRequestForm').addEventListener('submit', function (event) {
        // Add your validation logic here
        var StudentNumber = document.getElementById('StudentNumber').value.trim();
        var Name = document.getElementById('Name').value.trim();
        var certificationType = document.getElementById('CertificationType').value.trim();
        var request_form = document.getElementById('request_form').value.trim();
        var identification_card = document.getElementById('identification_card').value.trim();
        var isRepresentativeCheckbox = document.getElementById('IsRepresentative');
        var authorization_letter = document.getElementById('authorization_letter').value.trim();
        var representative_id = document.getElementById('representative_id').value.trim();

        if (!StudentNumber || !Name || !certificationType || !requestFormFile || !identificationCardFile) {
            alert('Please fill out all required fields.');
            event.preventDefault();  // Prevent form submission
>>>>>>> TEST
        }

        const metadataDetails = await response.json();

        if (metadataDetails.error) {
            alert(metadataDetails.error);
            return;
        }

        displayMetadataDetails(metadataDetails);
    } catch (error) {
        console.error('Error fetching metadata details:', error.message);
        alert('Error fetching metadata details. Check the console for more information.');
    }
}

function displayMetadataDetails(data) {
    const tableBody = document.getElementById("metadataDetailsTable").querySelector("tbody");
    tableBody.innerHTML = ''; // Clear existing rows

    Object.entries(data).forEach(([key, value]) => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${key}</td><td>${value}</td>`;
        tableBody.appendChild(row);
    });
}

</script>
{% endblock %}
