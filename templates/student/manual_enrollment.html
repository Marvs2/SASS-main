{% extends "student/home.html" %}

{% block services %}

    <h1>Manual Enrollment Request</h1>
    <p>This service is for both regular and irregular students of the University and is done during the adjustment period. It is used when the student fails to enroll during the online registration period set by the University.</p>

    <p><a href="{{url_for('download_RO_form')}}">Download Application file for Request Form</a></p>
    <br>  
    <br>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <br>
    <br>
    <br>
    <h1>Manual Enrollment Form</h1>
    <form action="{{ url_for('submit_manual_enrollment') }}" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
        <label for="student_number">Student Number:</label><br>
        <input type="text" id="student_number" name="student_number" required><br><br>

        <label for="student_name">Student Name:</label><br>
        <input type="text" id="student_name" name="student_name" required><br><br>

        <label for="enrollmentType">Enrollment Type:</label><br>
        <select id="enrollmentType" name="enrollmentType" required>
            <option value="Regular">Regular</option>
            <option value="Irregular">Irregular</option>
            <option value="Special">Special</option>
            <!-- Add more options as needed -->
        </select><br><br>
    
        <label for="reason">Reason:</label><br>
        <textarea id="reason" name="reason" rows="4" cols="50" required></textarea><br><br>

        <label for="meFile">File:</label><br>
        <input type="file" id="meFile" name="meFile" required><br><br>

        <label for="user_responsible">User Responsible:</label>
        <select id="user_responsible" name="user_responsible" required>
            <option value="Faculty">
                Faculty Member/s
            </option>
            <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
            <option value="CDO Cashier/Accounting Office">CDO Cashier/Accounting Office</option>
        </select><br><br>

        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="Sent" selected>Sending</option>
            <option value="Pending" disabled>Pending</option>
            <option value="Approved" disabled>Approved</option>
            <option value="Rejected" disabled>Rejected</option>
        </select><br><br>

        <button type="submit">Submit</button>
    </form>

    <script>
        function validateForm() {
            var studentNumber = document.getElementById('studentNumber').value;
            var studentName = document.getElementById('studentName').value;
            var enrollmentType = document.getElementById('enrollmentType').value;
            var reason = document.getElementById('reason').value;

            if (!studentNumber || !studentName || !enrollmentType || !reason) {
                alert('Please fill out all required fields.');
                return false;
            }

            // Additional validation logic can be added here

            return true;
        }

        // Handling submission success and error messages
        var form = document.querySelector('form');
        form.addEventListener('submit', function (event) {
            event.preventDefault();

            var formData = new FormData(form);

            fetch('/submit_manual_enrollment', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Network response was not ok.');
            })
            .then(data => {
                alert('Request submitted successfully: ' + data);
                // Redirect or perform any other action upon successful submission
            })
            .catch(error => {
                alert('Error submitting request: ' + error.message);
                // Handle errors or display appropriate message
            });
        });
    </script>
{% endblock %}

