{% extends "student/home.html" %}
<script>
    function getStudentNumber() {
        var studentName = document.getElementById('student_name').value;
        var studentNumberField = document.getElementById('student_number');

        // AJAX request to fetch the student number
        fetch('/get_student_number', {
            method: 'POST',
            body: new URLSearchParams({ student_name: studentName }),
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        })
        .then(response => response.text())
        .then(studentNumber => {
            if (studentNumber !== 'Student not found') {
                studentNumberField.value = studentNumber;
            } else {
                studentNumberField.value = '';
                alert('Student not found');
            }
        });
    }

    function handleAlertClose() {
        var alertDiv = document.getElementById('successAlert');
        alertDiv.style.display = 'none';  // Hide the alert
    }
</script>

{% block services %}

    <h1>Application for Change of Enrollment (Adding of Subjects)</h1>
    <p>Process request for application for change of enrollment specifically for adding of subjects. This is both for regular and irregular students of the University and is done during the adjustment period.
    </p>
    <br>
    <p><a href="{{url_for('download_AddingSubs')}}">Download Application file for Adding Subject</a></p>
    <br>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div id="successAlert" class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="handleAlertClose()">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <h2>Application Form</h2>
    <form action="{{ url_for('add_subjects') }}" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
        <label for="student_number">Student No.:</label><br>
        <input type="text" id="student_number" name="student_number" required><br><br>
    
        <label for="student_name">Student Name:</label><br>
        <input type="text" id="student_name" name="student_name" required onblur="getStudentNumber()"><br><br>

        <label for="subject_Names">Subject Name (comma-separated):</label>
        <input type="text" id="subject_Names" name="subject_Names" required><br><br>
    
        <label for="enrollment_type">Enrollment Type:</label><br>
        <select id="enrollment_type" name="enrollment_type" required>
            <option value="Regular">Regular</option>
            <option value="Irregular">Irregular</option>
        </select><br><br>

        <label for="file">File:</label>
        <input type="file" id="file" name="file"><br><br><!-- File input field -->
        
        <label for="user_responsible">User Responsible:</label>
        <select name="user_responsible" id="user_responsible">
            <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
            <option value="CDO Cashier/Accounting Office">CDO Cashier/Accounting Office</option>
            <option value="Registrar's Office">Registrar's Office</option>
        </select><br><br>

        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="Sent" selected>Sending</option>
            <option value="Pending" disabled>Pending</option>
            <option value="Approved" disabled>Approved</option>
            <option value="Rejected" disabled>Rejected</option>
        </select><br><br>

        <button type="submit" class="btn btn-primary btn-block">Submit Application</button>
    </form>
    
    <!-- JavaScript function to validate the form and log any errors -->
    <script>
        function validateForm() {
            var studentNumber = document.getElementById('student_number').value;
            var studentName = document.getElementById('student_name').value;
            var subject_Names = document.getElementById('subject_Names').value;
            var enrollmentType = document.getElementById('enrollment_type').value;


            // You can add your custom validation logic here
            if (!studentNumber || !studentName || !enrollmentType || !subject_Names) {
                console.error('Error: Please fill out all required fields.');
                // Return false to prevent form submission
                return false;
            }

            // Add additional validation checks here

            return true;
        }
    </script>
{% endblock %}
