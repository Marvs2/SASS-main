{% extends "student/layout.html" %}
{% block content %}
<style>
    .form-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        margin: auto;
        max-width: 900px; /* Adjust the width as needed */
        padding: 20px;
    }

    .container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    .column {
        flex: 0 0 48%; /* Adjust column width as needed */
    }

    /* Adjust other styles as necessary */
</style>


    <h1>Application for Change of Enrollment (Adding of Subjects)</h1>
    <p>Process request for application for change of enrollment specifically for adding of addsubjects. This is both for regular and irregular students of the University and is done during the adjustment period.</p>
    <br>
    <p><a href="{{url_for('download_AddingSubs')}}">Download Application file for Adding Subject</a></p>
    <br>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div id="successAlert" class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="handleAlertClose()">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <div class="form-container">
        <div class="container">
            <div class="column">
                <!-- Form -->
                <h2>Application Form</h2>
                <form action="{{ url_for('add_subjects') }}" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()" class="application-form">
                    <label for="StudentNumber">Student number:</label>
                    <input type="text" id="StudentNumber" name="StudentNumber" required onblur="getStudentNumber()"><br>
            
                    <label for="Name">Student Name:</label>
                    <input type="text" id="Name" name="Name" required><br>
            
                    <label for="subject_Names">Subject Name (comma-separated):</label>
                    <input type="text" id="subject_Names" name="subject_Names" required><br>
            
                    <label for="enrollment_type">Enrollment Type:</label>
                    <select id="enrollment_type" name="enrollment_type" required>
                        <option value="Regular">Regular</option>
                        <option value="Irregular">Irregular</option>
                    </select><br>
            
                    <label for="filesubject">File:</label>
                    <input type="file" id="filesubject" name="filesubject"><br><br>
            
                    <label for="user_responsible">User Responsible:</label>
                    <select name="user_responsible" id="user_responsible">
                        <option value="Director/Head of Academic Program">Director/Head of Academic Program</option>
                        <option value="CDO Cashier/Accounting Office">CDO Cashier/Accounting Office</option>
                        <option value="Registrar's Office">Registrar's Office</option>
                    </select><br><br>
            
                    <label for="status">Status:</label>
                    <select id="status" name="status">
                        <option value="Sent" selected>Sending</option>
                        <option value="Pending" disabled>Pending</option>
                        <option value="Approved" disabled>Approved</option>
                        <option value="Rejected" disabled>Rejected</option>
                    </select><br><br>
            
                    <button type="submit" class="btn btn-primary btn-block">Submit Application</button>
                </form>
            </div>
        </div>
    </div>
        <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <!-- Include Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

{% endblock content %}

{% block script %}
<script>
    // Automatically close the alert messages after 3 seconds
    setTimeout(function() {
        $('.alert').alert('close');
    }, 3000);

    // Form submission logic
    $('#addaddsubjectsApplicationForm').submit(function(event) {
        const form_data = {
            StudentNumber: $('#StudentNumber').val().trim(),
            Name: $('#Name').val().trim(),
            subject_Names: $('#subject_Names').val().trim(),
            enrollment_type: $('#enrollment_type').val().trim(),
            user_responsible: $('#user_responsible').val().trim(),
            status: $('#status').val().trim()
        };

        // Additional validation logic
        if (!form_data.StudentNumber || !form_data.Name || !form_data.subject_Names || !form_data.enrollment_type) {
            alert('Please fill out all fields and provide valid values.');
            event.preventDefault(); // Prevent form submission
        } else {
            // Log the form submission
            logFormSubmission(form_data);
        }

        // You can add more validation logic here as needed
    });

    function logFormSubmission(form_data) {
        $.ajax({
            type: 'POST',
            url: '/log_form_submission',  // Replace with your Flask route
            data: form_data,
            success: function(response) {
                console.log(response.message);
                // You can add any additional actions upon successful form submission
            },
            error: function(error) {
                console.error('Error logging form submission:', error);
            }
        });
    }

    // Fetch student details
    async function fetchStudentDetails() {
        try {
            const response = await fetch(`${api_base_url}/student-details`);

            if (!response.ok) {
                throw new Error(`Failed to fetch data. Server returned ${response.status}`);
            }

            const data_student_details = await response.json();
            console.log('data_student_details:', data_student_details);
            displayDetails(data_student_details);
        } catch (error) {
            console.error('Error fetching student details:', error.message);
        }
    }

    fetchStudentDetails();

    function displayDetails(data) {
        // Select the StudentNumber and set the value to data.StudentNumber
        document.getElementById('StudentNumber').value = data.StudentNumber;
        // Select the name input and set the value to data.Name
        document.getElementById('Name').value = data.Name;
    }
</script>
{% endblock script %}


