{% extends "main/base.html" %} 

{% block content %}
<div class="Box">
    <div class="box1">
        <h1 class="header header animate__bounceIn mt-3">Upcoming Events</h1>

        {% if posts %}
        <div id="carouselExampleControls" class="carousel">
            <div class="carousel-inner">
                {% for post in posts %}
                    {% if loop.index0 % 3 == 0 %}
                        <div class="carousel-item {% if loop.first %}active{% endif %}">
                    {% endif %}
                    <div class="card">
                        {% if post.ImgLink %}
                            <img src="{{ post.ImgLink }}" class="card-img-top" alt="...">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ post.Title }}</h5>

                           

                            <div id="postCollapse{{ loop.index }}" class="collapse flex-grow-1">
                                <div class="card-text announcementCard">
                                    {{ post.Content | safe }}
                                </div>
                            </div>
                            <div class="text-secondary mb-3">
                                <hr>
                            </div>
                            <input type="hidden" class="content" value="{{ post.Content }}">
                            <a href="#" class="btn learn-more-btn" data-toggle="collapse" data-target="#postCollapse{{ loop.index }}" onclick="toggleCollapse(event, '{{ loop.index }}')">
                                Read More ...
                            </a>
                        </div>
                    </div>
                    {% if loop.index0 % 3 == 2 or loop.last %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% else %}
        <p>No posts available.</p>
        {% endif %}
    </div>
</div>

<script>
    // Retrieve all elements with class name 'announcementCard' and 'content'
    const postCards = document.querySelectorAll(".announcementCard");
    const contentInputs = document.querySelectorAll(".content");

    // Function to toggle collapse manually
    function toggleCollapse(event, index) {
        event.preventDefault();  // Prevent the default behavior of the anchor element

        const collapseElement = document.getElementById("postCollapse" + index);
        const isCollapsed = collapseElement.classList.contains("show");

        // Collapse any open sections
        document.querySelectorAll('.collapse.show').forEach((element) => {
            element.classList.remove("show");
            // Change "See Less" to "Learn More" when collapsing
            const currentIndex = element.id.replace("postCollapse", "");
            document.querySelector(`[data-target="#postCollapse${currentIndex}"]`).innerHTML = "Learn More";
        });

        if (!isCollapsed) {
            // Change "Learn More" to "See Less" when expanding
            document.querySelector(`[data-target="#postCollapse${index}"]`).innerHTML = "See Less";

            // Scroll to the bottom of the expanded content if the button is not visible
            const buttonElement = event.target;
            if (!isElementInViewport(buttonElement)) {
                const contentBottom = collapseElement.offsetTop + collapseElement.scrollHeight;
                window.scrollTo({ top: contentBottom, behavior: "smooth" });
            }

            collapseElement.classList.add("show");
        }
    }

    // Function to check if an element is in the viewport
    function isElementInViewport(el) {
        const rect = el.getBoundingClientRect();
        return (
            rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <= (window.innerWidth || document.documentElement.clientWidth)
        );
    }

    // Iterate over each element and set its innerHTML
    postCards.forEach((postCard, index) => {
        const contentValue = contentInputs[index].value;
        postCard.innerHTML = contentValue;
    });
</script>

{% endblock %}
