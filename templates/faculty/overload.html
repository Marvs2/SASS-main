{% extends "faculty/layout.html" %}

{% block content %}
<style>
  .carousel-caption .card-title,
  .carousel-caption .text-muted {
    color: black;
  }
</style>

<div id="overloadTableContainer">
    <h1>Overload Applications</h1>
    <table id="overloadTable" class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Student Number</th>
                <th>Program/Course</th>
                <th>Semester</th>
                <th>Subjects to Add</th>
                <th>Justification</th>
                <th>Files</th>
                <th>User Responsible</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- Replace with your Flask template logic to populate rows -->
            {% for overload_application in overload_applications %}
                <tr>
                    <td>{{ overload_application.OverloadId }}</td>
                    <td>{{ overload_application.Name }}</td>
                    <td>{{ overload_application.StudentNumber }}</td>
                    <td>{{ overload_application.ProgramCourse }}</td>
                    <td>{{ overload_application.Semester }}</td>
                    <td>{{ overload_application.SubjectsToAdd }}</td>
                    <td>{{ overload_application.Justification }}</td>
                    <td>
                      {% if overload_application.Overloaddata %}
                          {% set truncated_overload_name = overload_application.Overloadfilename[:15] + '...' if overload_application.Overloadfilename|length > 15 else overload_application.Overloadfilename %}
                          <a href="{{ url_for('get_overload_file', overload_application_id=overload_application.OverloadId) }}" class="btn btn-success" download title="{{ overload_application.Overloadfilename }}" target="_blank">{{ truncated_overload_name }}</a>
                      {% else %}
                          <span class="badge badge-warning">No File</span>
                      {% endif %}
                  </td>
                    <td>{{ overload_application.UserResponsible }}</td>
                    <td>{{ overload_application.Status }}</td>
                    <td>
                        <button class="btn btn-primary" data-toggle="modal" data-target="#statusModal{{ overload_application.OverloadId }}">Change Status</button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

<!-- Modal for Editing -->
{% for overload_application in overload_applications %}
    <div class="modal fade" id="editModal{{ overload_application.OverloadId }}" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Overload Application for {{ overload_application.Name }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="editForm{{ overload_application.OverloadId }}" action="{{ url_for('submit_overload_applications', OverloadId=overload_application.OverloadId) }}" method="POST">
                    <div class="modal-body">
                        <!-- Include input fields for the information you want to edit -->
                        <div class="mb-3">
                            <label for="editStatus" class="form-label">Status</label>
                            <select name="Status" id="editStatus" class="form-select">
                                <option value="pending" {% if overload_application.Status == 'pending' %}selected{% endif %}>Pending</option>
                                <option value="processing" {% if overload_application.Status == 'processing' %}selected{% endif %}>Processing</option>
                                <option value="approved" {% if overload_application.Status == 'approved' %}selected{% endif %}>Approved</option>
                                <option value="finish" {% if overload_application.Status == 'finish' %}selected{% endif %}>Finish</option>
                                <option value="rejected" {% if overload_application.Status == 'rejected' %}selected{% endif %}>Rejected</option>
                                <!-- Add other statuses as needed -->
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" onclick="editApplication({{ overload_application.OverloadId }})">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endfor %}

<!-- ... Your existing HTML code ... -->

<script>
  // You can add any JavaScript logic here
  function editApplication(overloadId) {
      var newStatus = $('#editStatus').val();

      if (!newStatus) {
          alert('Please provide a new status.'); // You can customize this alert
          return;
      }

      // Add any custom logic you need before submitting the form
      // You can use AJAX to submit the form asynchronously if needed
      // Example: $('#editForm' + overloadId).submit();
  }
</script>


{% endblock %}
