{% extends "faculty/layout.html" %}

{% block content %}
<style>
    /* Add DataTables styles */
    table {
        width: 90%;
        border: 1px;
        margin-top: 20px;
        margin-left: 50px;
        margin-right: 50px;
        margin-bottom: 50px;
    }

    th, td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
</style>
<!--Done-->
<!-- DataTable HTML -->
<!-- Certification Requests -->
<h2>Certification Requests</h2>
<table id="certificationRequestsTable" class="display" style="width:80%">
	<thead>
		<tr>
			<th>Certification Id</th>
			<th>Student Number</th>
			<th>Name</th>
			<th>Certification Type</th>
			<th>Files</th>
			<th>Responsible</th>
			<th>Status</th>
			<th>Stud Id</th>
			<th>Action</th>
		</tr>
	</thead>
	<tbody>
		{% for certification_request in certification_request %}
			<tr>
				<td>{{ certification_request.certification_request_id }}</td>
				<td>{{ certification_request.StudentNumber }}</td>
				<td>{{ certification_request.Name }}</td>
				<td>{{ certification_request.certification_type }}</td>
				<td>        {% if certification_request.request_form_data %}
					<a href="{{ url_for('get_certification_request_file', certification_request_id=certification_request.certification_request_id) }}" class="btn btn-success" download>{{ certification_request.request_form_filename }}</a>
				{% else %}
					<span class="badge badge-warning">No File</span>
				{% endif %}
				,
				{% if certification_request.identification_card_data %}
					<a href="{{ url_for('get_certification_identification_file', certification_request_id=certification_request.certification_request_id) }}" class="btn btn-success" download>{{ certification_request.identification_card_filename }}</a>
				{% else %}
					<span class="badge badge-warning">No File</span>
				{% endif %}
				,
				{% if certification_request.authorization_letter_data %}
					<a href="{{ url_for('get_certification_authorization_file', certification_request_id=certification_request.certification_request_id) }}" class="btn btn-success" download>{{ certification_request.authorization_letter_filename }}</a>
				{% else %}
					<span class="badge badge-warning">No File</span>
				{% endif %}
				,
				{% if certification_request.representative_id_data %}
					<a href="{{ url_for('get_representative_file', certification_request_id=certification_request.certification_request_id) }}" class="btn btn-success" download>{{ certification_request.representative_id_filename }}</a>
				{% else %}
					<span class="badge badge-warning">No File</span>
				{% endif %}
				</td>
				<td>{{ certification_request.user_responsible }}</td>
				<td>{{ certification_request.status }}</td>
				<td>{{ certification_request.StudentId }}</td>
				<td>
					<!-- Add action buttons or options for Change of Subjects -->
					<button class="btn btn-primary" data-toggle="modal" data-target="#statusModal{{ certification_request.certification_request_id }}">View Status</button>
					<!-- Add other relevant action buttons -->
				</td>
			</tr>
		{% endfor %}
	</tbody>
</table>
<!-- Include DataTables script -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">

<!-- DataTable Initialization Script -->
<script>
    // Initialize DataTable
    $(document).ready(function() {
    $('#certificationRequestsTable').DataTable({
        "pageLength": 5
    });
});

  // Function to update status
  function updateStatus(certification_request_id) {
    const formId = `statusForm${certification_request_id}`;
    const form = document.getElementById(formId);
    const formData = new FormData(form);

    fetch('/faculty/certification', {
      method: 'POST',
      body: formData,
    })
      .then(response => response.json())
      .then(data => {
        alert(data.message);
        location.reload(); // Reload the page after successful update
      })
      .catch(error => {
        console.error('Error updating status:', error);
      });
  }
</script>

{% endblock %}