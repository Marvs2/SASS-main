{% extends "faculty/layout.html" %}

{% block content %}

<div class="progress progress-bar progress-bar-indeterminate bg-green"></div>

{% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
            <div id="successAlert" class="alert alert-success alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="handleAlertClose()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="data data1">
   
    <div class="content-data">
        <div class="head">
            <h3>Faculty Profile</h3>           
        </div>
        <form action="{{ url_for('faculty_update_profile') }}" id="profileForm" method="POST" onsubmit="updateFacultyProfile(event)">
            <div class="form-group">
              <label for="FacultyCode" class="col-sm-2 control-label">Faculty Type</label>
              <div class="col-sm-4">
                <input type="text" id="FacultyCode" name="FacultyCode" required="required" class="form-control" disabled>
              </div>
              <label for="BirthDate" class="col-sm-2 control-label">Date of Birth</label>
              <div class="col-sm-4">
                <input type="text" name="BirthDate" id="BirthDate" required="required" class="form-control" disabled>
              </div>
            </div>

            <div class="form-group">
              <label for="Name" class="col-sm-2 control-label">Name</strong></label>
              <div class="col-sm-4">
                <input type="text" name="Name" id="Name" required="required" class="form-control" disabled>
              </div>   
              <label for="ResidentialAddress" class="col-sm-2 col-sm-2 control-label">Place of Birth</strong></label>
              <div class="col-sm-4">
                <input type="text" name="ResidentialAddress" id="ResidentialAddress" required="required" class="form-control" disabled>
              </div>
            </div>

            <div class="form-group">
            <label for="Gender" class="col-sm-2 col-sm-2 control-label">Gender</strong></label>
              <div class="col-sm-4">
               <input type="text" name="Gender" id="Gender" required="required" class="form-control" disabled> 
              </div>
              <label for="Email" class="col-sm-2 col-sm-2 control-label">Email Address</strong></label>
              <div class="col-sm-4">
                <input type="Email" name="Email" id="Email" required="required" class="form-control">
              </div>
            </div>          
            <div class="form-group">
            <label for="MobileNumber" class="col-sm-2 col-sm-2 control-label">Contact Number</strong></label>
            <div class="col-sm-4">
              <input type="text"  name="MobileNumber" id="MobileNumber" required="required" maxlength="11" pattern="\d{11}" class="form-control">
            <!-- </div>
              <label for="address" class="col-sm-2 col-sm-2 control-label">Address</strong></label>
              <div class="col-sm-4">
              <input  name="address" id="address" required="required" class="form-control">
             </div>               -->
            </div>

            <div class="form-group">
              <div class="col-sm-11 text-center">
                <div class="pt-3 pl-4">
              <!---    <span><i>I hereby Certify that all the information provided are true and correct to the best of my knowledge.</i></span> -->
                </div>
              
                <div class="col-sm-13 d-flex justify-content-center">
                  <button type="submit" name="save-profile-button" class="btn btn-success">Save Profile</button>
                </div>
              </div>
            </div>       
          </form>
    </div>
</div>

{% endblock %}

{% block script %} 
<script>
    // Include the progress bar, alert handling, and data fetching functions as in the student profile script
    // ...
    setTimeout(function() {
        $('.alert').alert('close');
    }, 3000);


    async function fetchFacultyDetails() {
        const response = await fetch(`${api_base_url}/faculty-details`);

        if (!response.ok) {
            throw new Error(`Failed to fetch data. Try to contact the admin to resolve the issue.`);
        }

        const data_faculty_details = await response.json();
        console.log('data_faculty_details: ', data_faculty_details);
        displayDetails(data_faculty_details);
    }

    fetchFacultyDetails();

    function displayDetails(data){
      const fullName = `${data.FirstName} ${data.MiddleName ? data.MiddleName + ' ' : ''}${data.LastName}`;

        document.getElementById("Name").value = fullName;
        // Update the faculty profile details in the form
        // For example:
        document.getElementById("FacultyCode").value = data.FacultyCode;
        document.getElementById("Email").value = data.Email;
        // document.getElementById("address").value = data.address;
        document.getElementById("Gender").value = data.Gender;
        const BirthDateInput = document.getElementById("BirthDate");
        // Format the date to display only the birthday
const formattedBirthDate = new Date(data.BirthDate).toLocaleDateString('en-US', {
    month: 'long',
    day: 'numeric',
    year: 'numeric'
});
// Set the formatted date to the BirthDate input
BirthDateInput.value = formattedBirthDate;

        document.getElementById("ResidentialAddress").value = data.ResidentialAddress;
        document.getElementById("MobileNumber").value = data.MobileNumber;
        // ... (update other fields similarly)

        hideProgressBar();
    }

    // ... (include other functions and event listeners as needed)
</script>
{% endblock script %}
